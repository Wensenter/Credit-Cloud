<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <title>我的积分</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../../css/myPoints/myPoints.css"
    />
    <script src="../../js/flexible.js"></script>
  </head>

  <body>
    <div class="wrapper">
      <!-- 我的积分 -->
      <div class="points">
        <div class="points-title">我的积分</div>
        <div class="points-value">1845</div>
        <div class="points-check"></div>
      </div>
      <div class="calender-wrapper">
        <div class="title-wrapper">
          <div class="title">签到获取积分</div>
          <div class="intro">连续签到7天/15天/30天可玩幸运大转盘</div>
          <a href="./pointsDetail.html" class="detail-points"
            >积分明细<i class="icon-detail"></i
          ></a>
        </div>
        <div id="calender" class="calender"></div>
      </div>
      <div class="rules">
        <img src="../../images/myPoints/rules.png" alt="" />
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/1.30.1/date_fns.min.js"></script>
    <script src="../../js/myPoints.js"></script>
    <script src="../../common/jquery.min.js"></script>
    <!-- mock数据 可删 -->
    <script>
      var daysArray0 = [
        {
          date: new Date('2019-08-01'),
          isLottery: false,
          hasSign: true,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-02'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: true
        },
        {
          date: new Date('2019-08-03'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-04'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-05'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-06'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-07'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-08'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-09'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-10'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-11'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-12'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-13'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-14'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-15'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-16'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-17'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-18'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-19'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-20'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-21'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-22'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-23'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-24'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-25'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-26'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-27'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-28'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-29'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-08-30'),
          isLottery: false,
          hasSign: false,
          lotteryafter: true,
          isToday: false
        },
        {
          date: new Date('2019-08-31'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        }
      ];
      var daysArray1 = [
        {
          date: new Date('2019-07-01'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-02'),
          isLottery: false,
          hasSign: false,
          lotteryafter: true,
          isToday: true
        },
        {
          date: new Date('2019-07-03'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-04'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-05'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-06'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-07'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-08'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-09'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-10'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-11'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-12'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-13'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-14'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-15'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-16'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-17'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-18'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-19'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-20'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-21'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-22'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-23'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-24'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-25'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-26'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-27'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-28'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-29'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        },
        {
          date: new Date('2019-07-30'),
          isLottery: false,
          hasSign: false,
          lotteryafter: true,
          isToday: false
        },
        {
          date: new Date('2019-07-31'),
          isLottery: false,
          hasSign: false,
          lotteryafter: false,
          isToday: false
        }
      ];
    </script>
    <script>
      // hassign:已签到 lottery 抽奖  lotteryafter 以后抽奖 signtoday 今天已经签到
      // 初始化日历
      var calender = new Calender(daysArray0);
      console.log(daysArray0);
      calender.render();
      // 处理今天签到
      function handleSign() {
        $this = $(event.target);
        if (!$this.hasClass('sign-today')) return;
        console.log(
          '签到成功',
          $this
            .parent()
            .find('.date')
            .attr('data-date')
        );
        $this.removeClass('sign-today').addClass('has-sign');
        // TODO 上传签到数据
      }

      // 今天抽奖
      function handleLotteryToday() {
        $this = $(event.target);
        if ($this.hasClass('lottery')) {
          // TODO 抽奖
          console.log('抽奖');
        } else if ($this.hasClass('sign-today')) {
          $this.removeClass('sign-today').addClass('lottery');
          console.log('签到成功');
        }
      }
      // 处理中奖
      function handleLottery() {
        // TODO 处理抽奖
        console.log('抽奖');
      }

      // 处理上个月
      function handlePrev(date) {
        var currentDate = date.split('-');
        var year = currentDate[0];
        var month = currentDate[1];
        // 渲染其他月份
        calender.renderNewMonth(daysArray0);
        console.log(year, month);
      }
      // 处理下个月
      function handleNext(date) {
        var currentDate = date.split('-');
        var year = currentDate[0];
        var month = currentDate[1];
        // 渲染其他月份
        calender.renderNewMonth(daysArray1);
        console.log(year, month);
      }
    </script>
  </body>
</html>
